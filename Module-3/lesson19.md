# Урок №19. События и делегаты, потоки

## Полезные ссылки

[События и делегаты](http://www.electronick.org.ua/articles/sobytiya_i_delegaty_v_yazyke_csharp/)

[Делегаты и события в .NET](https://habr.com/post/198694/)

[Делегаты, события и лямбды](https://metanit.com/sharp/tutorial/3.13.php)

[Delegates and Events](https://msdn.microsoft.com/en-us/library/ms235237.aspx)

[События C# по-человечески](https://habr.com/post/213809/)

[Процессы](https://metanit.com/sharp/tutorial/18.1.php)

[Потоки и работа с потоками](https://msdn.microsoft.com/ru-ru/library/6kac2kdh(v=vs.100).aspx)

## Делегат

![Delegate](/Module-3/images/delegate-detailed.png)

* Класс

* Указатель на функцию

public delegate string FirstDelegate (int x);
FirstDelegate d1 = new FirstDelegate(DelegateTest.StaticMethod);
Console.WriteLine (d1(10));

![Delegate](/Module-3/images/delegate1.png)
![Delegate](/Module-3/images/delegate2.png)

### Ограничения делегатов

* Строгое соответствие сигнатуры делегата и сигнатуры функции

* Не может быть static

* Invoke для вызова

* Не наследуются!

## События

![Событие](/Module-3/images/event1.png)

Примеры событий в приложениях?

1. Объявляем делегат

public delegate void SelectDateEventHandler(object sender, DateSelectEventArgs args);

2. Объявляем событие (экземпляр делегата)

public event SelectDateEventHandler SelectDateMsg;

3. void OnSelectDate(DateSelectEventArgs e)

4. void SimulateSelectDate()

![Событие](/Module-3/images/event2.png)

## Процессы и потоки

![Событие](/Module-3/images/processes-threads.png)

### Достоинства потоков

* Взаимодействие по сети с веб-сервером и базой данных.
* Выполнение операций, занимающих много времени.
* Разделение задач по приоритетам. Например, поток с высоким приоритетом отвечает за срочные задачи, с низким приоритетом — за все остальные.
* Сохранение возможности ответа для интерфейса пользователя при выделении времени для фоновой задачи.

### Недостатки потоков

* Память, используемая системой для обработки контекстных данных, необходимых в процессах, объектах AppDomain и потоках.Поэтому количество создаваемых процессов, объектов AppDomain и потоков ограничено объемом доступной памяти.

* Время процессора, используемое для отслеживания количества потоков. Если количество потоков велико, большинство из них не будет работать должным образом. Если большинство текущих потоков находится в одном процессе, потоки других процессов планируются реже.

* Контроль выполнения кода с большим количеством потоков достаточно сложен и может являться причиной ошибок.

* При уничтожении потоков необходимо учитывать возможные проблемы и предусмотреть способы их решения.

### Синхронизация потоков

* Системные ресурсы (последовательные порты);

* Ресурсы, используемые несколькими процессами (дескрипторы файлов);

* Ресурсы отдельного домена приложения (глобальные, статические поля или поля экземпляров), к которым обращаются несколько потоков.

## Домашнее задание

1. Теория
2. Практика

Реализовать delegate dictionary, который в зависимости от типа введенной фигуры (окружность, квадрат, прямогуольник,
треугольник) рассчитает площадь фигуры и длину окружности.
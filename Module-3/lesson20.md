# Урок №20. Многопоточность, асинхронное программирование

## Полезные ссылки

[Многопоточность](https://metanit.com/sharp/tutorial/11.1.php)

[Threading in C#](http://www.albahari.com/threading/)

[C# Multithreading](https://www.tutorialspoint.com/csharp/csharp_multithreading.htm)

[Асинхронные методы](https://metanit.com/sharp/tutorial/13.3.php)

[Гонка данных](https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5_%D0%B3%D0%BE%D0%BD%D0%BA%D0%B8)

[Синхронизация потоков](https://metanit.com/sharp/tutorial/11.4.php)

[Синхронизация потоков](https://www.c-sharpcorner.com/UploadFile/de41d6/monitor-and-lock-in-C-Sharp/)

[lock vs monitor](https://www.c-sharpcorner.com/UploadFile/de41d6/monitor-and-lock-in-C-Sharp/)

[Семафор](https://metanit.com/sharp/tutorial/11.8.php)

[Потокобезопасные объекты](https://blogs.msdn.microsoft.com/ruericlippert/2009/10/18/2133/)

[PLINQ](https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/parallel-linq-plinq)

## Таймер

Данный класс позволяет запускать определенные действия по истечению некоторого периода времени.

TimerCallback tm = new TimerCallback(Count); // Делегат

Timer timer = new Timer(tm, num, 0, 2000);

Интервал указан в миллисекундах.

### Практика

Fizz-Buzz по таймеру. Входной параметр - количество секунда.

## Класс Thread

* (static) **CurrentContext** контекст выполнения потока

* (static) **CurrentThread** ссылка на выполняемый поток

* **IsAlive** – маркер работы потока в текущий момент

* **IsBackground** – маркер фонового потока

* **Name** - имя потока

**Priority** - приоритет потока

* Lowest
* BelowNormal
* Normal
* AboveNormal
* Highest

**ThreadState** – состояние потока

* Aborted: поток остановлен, но пока еще окончательно не завершен
* AbortRequested: для потока вызван метод Abort, но остановка потока еще не произошла
* Background: поток выполняется в фоновом режиме
* Running: поток запущен и работает (не приостановлен)
* Stopped: поток завершен
* StopRequested: поток получил запрос на остановку
* Suspended: поток приостановлен
* SuspendRequested: поток получил запрос на приостановку
* Unstarted: поток еще не был запущен
* WaitSleepJoin: поток заблокирован в результате действия методов Sleep или Join

**GetDomain** возвращает ссылку на домен приложения
Статический метод GetDomainId возвращает id домена приложения, в котором выполняется текущий поток
Статический метод Sleep останавливает поток на определенное количество миллисекунд
Метод **Abort** уведомляет среду CLR о том, что надо прекратить поток, однако прекращение работы потока происходит не сразу, а только тогда, когда это становится возможно. Для проверки завершенности потока следует опрашивать его свойство ThreadState
Метод **Interrupt** прерывает поток на некоторое время
Метод **Join** блокирует выполнение вызвавшего его потока до тех пор, пока не завершится поток, для которого был вызван данный метод
Метод **Resume** возобновляет работу ранее приостановленного потока
Метод **Start** запускает поток
Метод **Suspend** приостанавливает поток

## Делегат ParameterizedThreadStart

Thread myThread = new Thread(new ParameterizedThreadStart(Filter));        
myThread.Start(name); 

## Гонка данных

ОШИБКА ПРОЕКТИРОВАНИЯ!!!!

Работы приложения зависит от порядка выполнения частей кода!!!

## Синхронизация потоков

* Объект заглушка

* Lock

## Семафор 

Семафор — объект, ограничивающий количество потоков, которые могут войти в заданный участок кода. 
Семафоры используются для синхронизации и защиты передачи данных через разделяемую память, а также 
для синхронизации работы процессов и потоков.

## Mutex

Мьютекс – («взаимное исключение») — аналог одноместного семафора.
**Только владеющий им поток может его освободить, т.е. перевести в отмеченное состояние.**

## Потоковая безопасность

Потоковая безопасность - концепция программирования, применимая к мнопоточным программам. 
Код потокобезопасен, если он функционирует исправно при использовании его из нескольких потоков одновременно. 
В частности, он должен обеспечивать правильный доступ нескольких потоков к разделяемым данным.

* **Реентерабельность** – код может быть частично выполнен одним потоком, затем другим и продолжен первым
* **Линериаезуемость** – методы реализованы таким образом, что их параллельное выполнение эквивалентно 
последовательному

## Домашнее задание

1. Теория
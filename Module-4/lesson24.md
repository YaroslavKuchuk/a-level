# Урок №24. Объекты базы данных

## Полезные ссылки

[Создание объектов базы данных](https://docs.microsoft.com/en-us/sql/t-sql/lesson-1-creating-database-objects?view=sql-server-2017)

[Представления](https://docs.microsoft.com/en-us/sql/relational-databases/views/views?view=sql-server-2017)

[Хранимые процедуры](https://www.mssqltips.com/sqlservertutorial/160/sql-server-stored-procedure-tutorial/)

[Stored procedures in SQL Server](https://www.w3schools.com/sql/sql_stored_procedures.asp)

[Triggers in SQL Server](https://www.mssqltips.com/sqlservertutorial/2911/create-sql-server-trigger/)


## Основные понятия

![Объекты базы данных](/Module-4/images/database-objects.png)

**Объект базы данных** - любой определенный объект в базе данных, используемый для хранения/получения данных.
Примерами объектов являются таблицы, представления, кластеры, последовательности, индексы и синонимы.
Таблица - основной, по умолчанию, объект базы данных.


### Представление (View)

Очень грубо говоря, представление - это виртуальная таблица.

![Представление](/Module-4/images/view.png)

В отличии от обычных стандартных таблиц в базе данных представления содержат запросы, которые динамически извлекают используемые данные из других таблиц/представлений/функций.

Представления дают нам следующий набор преимуществ:

- Упрощают комплексные запросы и позволяют соблюсти **DRY**
- Способствуют инкапсуляции и дополнительной защите данных путем ограничения доступа собственно к таблице
- Пзволяют возвращать отформатированные нужным образом данные 

### Хранимая процедура

![Хранимая процедура](/Module-4/images/stored-procedure-main.png)

Набор инструкций рассматриваемый как одно целое. 

- Увеличивает производительноссть засчет оптимизированного плана запроса.

![Хранимая процедура](/Module-4/images/stored-procedure-syntax.png)

### Функция

![Отличия функции от храимой процедуры](/Module-4/images/functions-vs-sps.png)


### Триггер

![Триггер](/Module-4/images/triggers.png)

Триггеры представляют специальный тип хранимой процедуры, которая вызывается автоматически при выполнении определенного действия 
над таблицей или представлением, в частности, при добавлении, изменении или удалении данных, то есть при выполнении команд INSERT, UPDATE, DELETE.

**Чем-то похоже на события в C#**


## Индексы

### Общая информация

![Индексы, общая информация](/Module-4/images/indexes-general.png)

### Кластеризованные

![Кластеризованные индексы](/Module-4/images/clustered-indexes.png)

- **Кластеризованный индекс** хранит реальные строки данных в листьях индекса.
- **Кластеризованные индексы** сортируют и хранят строки данных в таблицах или представлениях на основе их ключевых значений.
- Строки данных в таблице хранятся в порядке сортировки только в том случае, если таблица содержит **кластеризованный индекс**.

### Некластеризованные

![Некластеризованные индексы](/Module-4/images/non-clustered-indexes.png)

- **Некластеризованные индексы** имеют структуру, отдельную от строк данных. В некластеризованном индексе содержатся значения ключа **некластеризованного индекса**, и каждая запись значения ключа содержит указатель на строку данных, содержащую значение ключа.
- Указатель из строки индекса в **некластеризованном индексе**, который указывает на строку данных, называется указателем строки.

## Домашнее задание

1. Вернемся к нормализованному примеру из прошлого урока. Сделать представление (view), которое сумеет вернуть денормализованные данные
2. Заменить все расчетные значения на соотвествующие функции
3. Продумайте, где бы могли применить индексы в нормализованной структуре. И почему? И как?

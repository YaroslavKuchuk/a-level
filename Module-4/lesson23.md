# Урок №23. Начало работы с базами данных

## Полезные ссылки

[SQL Tutorial](https://www.geeksforgeeks.org/sql-tutorial/)

[SQL. Задачи и решения](http://www.sql-tutorial.ru/ru/content.html)

[Нормальная форма](https://ru.wikipedia.org/wiki/%D0%9D%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%84%D0%BE%D1%80%D0%BC%D0%B0)

[Нормализация отношений. Шесть нормальных форм.](https://habr.com/ru/post/254773/)

[JOINs в SQL](http://www.albahari.com/valuevsreftypes.aspx)


## Основные понятия

![Структура реляционной базы](/Module-4/images/relational-db.png)

**Тип данных** - также как и в C#, тип данных.

**Домен** – столбец

**Кортеж** – строка

**Отношение** – набор упорядоченных кортежей (строк)


### Отношение

Очень грубо говоря, отношение - это таблица

![Отношение](/Module-4/images/relationship.png)

## Реляционная алгебра

Реляционная алгебра — замкнутая система операций над отношениями в реляционной модели данных.

### Основные операции реляционной алгебры

Первоначальный набор был предложен Э. Коддом в 1970-е годы.

![Э. Кодд](/Module-4/images/kodd.png)

- **Объединение**
- **Пересечение** - отношение, состоящее из кортежей, полностью входящих в состав обоих отношений. 
- **Вычитание** - отношение, состоящее из кортежей, которые являются кортежами первого отношения и не являются кортежами второго отношения
- **Декартово произведение** - отношение со всеми доменами из двух начальных отношений
- **Выборка** - выделяет набор кортежей, соотвествующий некоторым критериям
- **Проекция** - подмножество атрибутов из доменов оригинального отношения
- **Соединение** - новое отношение из нескольких уже существующих
- **Деление**

## Нормальные формы

**Нормальная форма** — требование, предъявляемое к структуре таблиц в теории реляционных баз данных для устранения 
из базы избыточных функциональных зависимостей между атрибутами (полями таблиц)

### Первая нормальная форма (1NF) 
Основные критерии: 
- Все строки должны быть различными. 
- Все элементы внутри ячеек должны быть атомарными (не списками). 
Другими словами, элемент является атомарным, если его нельзя разделить на части, которые могут использовать в таблице независимо друг от друга.

![Первая нормальный форма](/Module-4/images/1nf.png)

### Вторая нормальная форма (2NF) 

Основные критерии: 
- Таблица должна находиться в первой нормальной форме. 
- Любое её поле, не входящее в состав первичного ключа, функционально полно зависит от первичного ключа.

![Первая нормальный форма](/Module-4/images/2nf.png)

### Третья нормальная форма (3NF) 

Основные критерии: 
- Таблица находится во второй нормальной форме. 
- Любой её не ключевой атрибут функционально зависит только от первичного ключа.

![Первая нормальный форма](/Module-4/images/3nf.png)

## Основы SQL

### SELECT

![SELECT](/Module-4/images/select-statement.png)

### INSERT

![INSERT](/Module-4/images/insert-statement.png)

### UPDATE

![UPDATE](/Module-4/images/update-statement.png)

### DELETE

![DELETE](/Module-4/images/delete-statement.png)

## JOINs

![JOINs](/Module-4/images/joins-simple.png)

![JOINs](/Module-4/images/joins-funny.png)


## Домашнее задание

1. По такому же примеру как был в классе - импортировать данные в базу данных SQL Server из [файла](/Module-4/materials/Superstore.xls).
Нормализовать структуру и смигрировать данные.

2. Реализовать структуру указанную на рисунке ниже.

![ДЗ](/Module-4/images/home-task.png)

Заполнить тестовыми данными.
Выполнить следующие запросы:

- Отсортированный в обратном порядке список отделов с количеством сотрудников

- Вывести список сотрудников, получающих заработную плату большую чем у 
непосредственного руководителя

- Вывести список отделов, количество сотрудников в которых не превышает 3 человек

- Вывести список сотрудников, получающих максимальную заработную плату в своем отделе

- Найти список отделов с максимальной суммарной зарплатой сотрудников

- Вывести список сотрудников, не имеющих назначенного руководителя, 
работающего в том-же отделе

- SQL-запрос, чтобы найти вторую самую высокую зарплату работника

